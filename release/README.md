# Geplo frontend release

This directory contains the release Dockerfile and the nginx conf used by the runtime.

## Nginx

The release relies on nginx to serve the static assets. The configuration is in `default.conf`.
This configuration is meant to be used being AWS ELB, but probably works with other load balancers as well.

It looks up the `http_x_forwarded_proto` to force redirect to the https if accessed via http.
It listens on both 80 and 443 with http (and *not* https for 443, we rely on ELB to handle ssl).

## Dockerfile

The release `Dockerfile` starts from the latest `nginx` image from the official Docker registry.
It then adds the `.mk_assets.tar.gz` archive generated by the Makefile and puts in place the files at the
appropriate place.

## Asset generation

In order to generate the assets, we use `webpack` via the `Makefile` and the main `Dockerfile`.
First, the Makefile builds the main `Dockerfile` using `npm run build` which in turn calls webpack in production mode,
then archives the generated static files and the nginx config.
